<!DOCTYPE html>


<!--


#


# Copyright(C) 2023-2025 AllStarLink


# Allmon3 and all components are Licensed under the AGPLv3


# see https://raw.githubusercontent.com/AllStarLink/Allmon3/develop/LICENSE


# Bootstrap libraries are licensed separately


# SVG icons inline are from FontAwesome licensed under CC-BY-4.0


# create commons with attribution


#


-->


<html lang="en">


<head>


    <meta http-equiv="content-type" content="text/html; charset=UTF-8">


    <meta charset="utf-8">


    <meta name="viewport" content="width=device-width, initial-scale=1">


    <meta name="description" content="">


    <meta name="author" content="AllStarLink">


    <title>Allmon3</title>



    <!-- CSS -->


    <link href="css/bootstrap.min.css?v=1.7.0" rel="stylesheet" crossorigin="anonymous">


    <link href="css/main.css?v=1.7.0" rel="stylesheet">


    <link href="css/custom.css?v=1.7.0" rel="stylesheet">



    <!-- Favicons -->


    <link rel="apple-touch-icon" href="img/favicons/favicon-180x180.png" type="image/png" sizes="180x180">


    <link rel="icon" href="img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">


    <link rel="icon" href="img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">


    <link rel="icon" href="img/favicons/favicon.ico" type="image/png">


</head>


<body>



<!-- SVG Symbols -->


<svg xmlns="http://www.w3.org/2000/svg" style="display:none;">


    <symbol id="settings" fill="currentColor" viewBox="0 0 16 16">


        <path d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434l.071-.286zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5zm0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78h4.723zM5.048 3.967c-.03.021-.058.043-.087.065l.087-.065zm-.431.355A4.984 4.984 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8 4.617 4.322zm.344 7.646.087.065-.087-.065z"/>


    </symbol>


    <!-- ... other symbols remain unchanged ... -->


</svg>



<header class="navbar navbar-dark sticky-top flex-md-nowrap p-0">


    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="index.html">


        <img id="header-banner-img" class="header-banner-img" src="img/asl-banner-logo.png" alt="asl-logo">


    </a>


    <button id="collapse-navbar-button" class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">


        <span class="navbar-toggler-icon"></span>


    </button>


    <div id="navbar-midbar" class="navbar-midbar d-none d-sm-block"></div>


    <div id="navbar-right" class="navbar-right"></div>


</header>



<!-- Login Modal -->


<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static">


    <div class="modal-dialog">


        <form id="loginBox" onsubmit="doLogin(); return false;">


            <div id="login-modal-content" class="modal-content">


                <div class="modal-header">


                    <h5 class="modal-title" id="loginModalLabel">Login</h5>


                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>


                </div>


                <div id="login-modal-body" class="modal-body">


                    <div class="container-flex">


                        <div class="row align-items-center">


                            <div class="col-4 fw-bolder text-end">


                                <label for="user">Username</label>


                            </div>


                            <div class="col-6">


                                <input type="text" autocomplete="username" size="20" id="user" name="user"><br>


                            </div>


                        </div>


                        <div class="row align-items-center mt-2">


                            <div class="col-4 fw-bolder text-end">


                                <label for="pass">Password</label>


                            </div>


                            <div class="col-6">


                                <input type="password" autocomplete="current-password" size="20" id="pass" name="pass">


                            </div>


                        </div>


                    </div>


                </div>


                <div id="login-modal-footer" class="modal-footer mt-2">


                    <input type="hidden" id="login-action" name="action" value="login">


                    <button type="submit" class="btn btn-secondary">Login</button>


                    <button type="button" class="btn btn-secondary" onclick="clearLogin()" data-bs-dismiss="modal">Cancel</button>


                </div>


            </div>


        </form>


    </div>


</div>



<!-- Logout Modal -->


<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true" data-bs-backdrop="static">


    <div class="modal-dialog">


        <form id="logoutBox">


            <div id="logout-modal-content" class="modal-content">


                <div class="modal-header">


                    <h5 class="modal-title" id="logoutModalLabel">Logout</h5>


                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>


                </div>


                <div id="logout-modal-body" class="modal-body">


                    Do you want to logout?


                    <input type="hidden" id="logout-action" name="action" value="logout">


                </div>


                <div id="logout-modal-footer" class="modal-footer">


                    <button type="button" class="btn btn-secondary" onclick="doLogout()">Logout</button>


                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="clearLogout()">Cancel</button>


                </div>


            </div>


        </form>


    </div>


</div>



<!-- Command Modal -->


<div class="modal fade" id="commandModal" tabindex="-1" aria-labelledby="commandModalTitleBox" aria-hidden="true" data-bs-backdrop="static">


    <div class="modal-dialog modal-xl">


        <div id="command-modal-content" class="modal-content modal-dialog-scrollable">


            <div class="modal-header">


                <h5 class="modal-title" id="commandModalTitleBox"></h5>


                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>


            </div>


            <div id="command-modal-body" class="modal-body"></div>


            <div id="command-modal-footer" class="modal-footer">


                <button id="cmd-exec-close" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>


            </div>


        </div>


    </div>


</div>



<!-- Main Page -->


<div class="container-fluid">


    <div class="row">


        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">


            <div class="position-sticky pt-3 sidebar-sticky">


                <div class="d-grid gap-2 col-9 mx-auto my-2">


                    <a id="nav-home-button" class="btn btn-secondary" role="button">


                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="align-text-bottom" aria-hidden="true">


                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>


                            <polyline points="9 22 9 12 15 12 15 22"></polyline>


                        </svg>


                        Home


                    </a>


                </div>


                <div id="asl-node-navigation"></div>


                <hr>


                <div id="login-out-region"></div>


                <hr>


                <div class="text-center text-wrap">


                    <img src="img/asl-sidebar-logo.png" alt="asl-logo"><br>


                    <b>Allmon v3</b><br>


                    <span style="color:red">1.7.0</span>


                </div>


            </div>


        </nav>



        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">


            <div id="asl-statmon-dashboard-area"></div>


            <!-- Announcements Manager will be appended here after login -->


        </main>



        <footer class="col-md-9 ms-sm-auto col-lg-10 px-md-4 my-2 mx-3">


            <hr>


            <p>Copyright &copy; 2023-2025 AllStarLink<br>


            Allmon3 is distributed under the terms of the <a href="https://raw.githubusercontent.com/AllStarLink/Allmon3/develop/LICENSE">AGPLv3</a></p>


        </footer>


    </div>


</div>



<!-- Scripts -->


<script src="js/bootstrap.bundle.min.js?v=1.7.0" crossorigin="anonymous"></script>


<script src="js/functions.js?v=1.7.0" crossorigin="anonymous"></script>


<script src="js/commands.js?v=1.7.0" crossorigin="anonymous"></script>


<script src="js/index.js?v=1.7.0" crossorigin="anonymous"></script>



<!-- jQuery - required for announcement manager JavaScript -->


<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>



<!-- Load Announcements Manager after successful login -->


<script>


document.addEventListener('DOMContentLoaded', function() {


    // Hook into Allmon3's doLogin function (or create if not exists)


    const originalDoLogin = window.doLogin || function(){ return Promise.resolve(); };



    window.doLogin = async function(...args) {


        const result = await originalDoLogin.apply(this, args);



        // Check if login appears successful (common indicators in Allmon3)


        const dashboard = document.getElementById('asl-statmon-dashboard-area');


        const isLoggedIn = 


            (dashboard && dashboard.innerHTML.trim() !== '') ||


            localStorage.getItem('loggedIn') === 'true' ||


            document.querySelector('#login-out-region')?.innerHTML.includes('Logout');



        if (isLoggedIn) {


            let container = document.getElementById('announcements-container');


            if (!container) {


                container = document.createElement('div');


                container.id = 'announcements-container';


                container.style.marginTop = '40px';


                container.style.padding = '20px 0';


                container.style.borderTop = '2px solid #dee2e6';


                dashboard.appendChild(container);


            }



            // Fetch and inject announcement.inc


            fetch('custom/allmon-announcement.inc')


                .then(response => {


                    if (!response.ok) throw new Error(`HTTP ${response.status}`);


                    return response.text();


                })


                .then(html => {


                    // Remove PHP logic parts (since we're client-side)


                    let cleaned = html


                        .replace(/<\?php\s*if\s*\([^)]*\)\s*\{[\s\S]*?\}\s*\?>/gs, '')


                        .replace(/<\?php[\s\S]*?\?>/gs, '')


                        .trim();



                    container.innerHTML = cleaned;



                    // Execute any <script> blocks inside the loaded content


                    const scripts = container.getElementsByTagName('script');


                    Array.from(scripts).forEach(oldScript => {


                        const newScript = document.createElement('script');


                        Array.from(oldScript.attributes).forEach(attr => {


                            newScript.setAttribute(attr.name, attr.value);


                        });


                        newScript.appendChild(document.createTextNode(oldScript.innerHTML));


                        oldScript.parentNode.replaceChild(newScript, oldScript);


                    });



                    console.log('Announcements Manager loaded successfully');


                })


                .catch(err => {


                    console.error('Failed to load Announcements Manager:', err);


                    container.innerHTML = `


                        <div class="alert alert-warning mt-4">


                            <strong>Announcements Manager failed to load:</strong><br>


                            ${err.message}<br>


                            Check: file exists at <code>custom/announcement.inc</code> and permissions are correct.


                        </div>`;


                });


        }



        return result;


    };


});


</script>



</body>


</html>

